<div class="container">
  <div class="row">
    <div class="col-md-2">
      <h3>Collections</h3>
      <div class="list-group">
        {{for collection in selected_users_collections:}}
        {{active_collection = collection.id == selected_collection.id}}
        <a href="{{=URL(vars={'with': receiver.id, 'user': selected_collection.owner, 'collection': collection.id})}}" class="list-group-item {{if active_collection:}}active{{pass}} proposal-button">
          {{=collection.name}}
        </a>
        {{pass}}
      </div>
      <hr/>
    </div>
    
    <div class="col-md-5">
      <div class="tabs">
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" {{if selected_user.id != auth.user.id:}}class="active"{{pass}}>
            <a href="{{=URL(vars={'with': receiver.id, 'user': receiver.id})}}" class="proposal-button">Their Items</a>
          </li>
          <li role="presentation" {{if selected_user.id == auth.user.id:}}class="active"{{pass}}>
            <a href="{{=URL(vars={'with': receiver.id, 'user': auth.user.id})}}" class="proposal-button">Your Items</a>
          </li>
          
          <li class="collection-search">
            <form role="search" method="get" class="search-form">
              <div class="input-group input-group-sm">
                <input type="hidden" value="{{=receiver.id}}" name="with">
                <input type="hidden" value="{{=selected_collection.id}}" name="collection">
                <input type="text" autocomplete="off"  value="{{=search}}" name="search" class="form-control input-sm" placeholder="Search this collection" list="objectsearch">
                <span class="input-group-btn">
                  <button type="submit" class="btn btn-default btn-sm search-button" title="Search"><i class="glyphicon glyphicon-search"></i></button>
                </span>
              </div>
            </form>
          </li>
        </ul>
        
        <datalist id="objectsearch">
          {{for item in all_collection_items:}}
          <option value="{{=item.name}}"></option>
          {{pass}}
        </datalist>
        
        <div class="tab-content">
        	{{if selected_user.id == auth.user.id:}}
          <div role="tabpanel" class="tab-pane active" id="your-items">
          {{else:}}
        	<div role="tabpanel" class="tab-pane active" id="their-items">
          {{pass}}
            {{if len(selected_items) > 0:}}
            {{for item in selected_items:}}
            {{item_selected = len([i for i in all_proposal_items if i.id == item.id]) > 0}}
            {{if item_selected:}}
            <a href="{{=URL(vars={'with': receiver.id, 'user': selected_user.id, 'remove': item.id, 'collection': selected_collection.id})}}" class="proposal-button">
            {{else:}}
            <a href="{{=URL(vars={'with': receiver.id, 'user': selected_user.id, 'add': item.id, 'collection': selected_collection.id})}}" class="proposal-button">
            {{pass}}
              <div class="panel panel-default col-md-4 {{if item_selected:}}selected-panel{{pass}}">
                <img src="{{=URL('static', 'images', args=['thumbnail.jpg'])}}" style="max-width:100%;"/>
                <div class="panel-body">
                  <h4>{{=item.name}}</h4>
                  <hr/>
                </div>
              </div>
            </a>
            {{pass}}
            {{else:}}
            <div class="alert alert-info">There are no objects in this collection.</div>
            {{pass}}
          </div>
          
          {{if selected_user.id == auth.user.id:}}
        	<div role="tabpanel" class="tab-pane" id="their-items"></div>
          {{else:}}
          <div role="tabpanel" class="tab-pane" id="your-items"></div>
          {{pass}}
        </div>
      </div>
    </div>
    <div class="col-md-5">
      {{proposal_items = proposal_items_from_receiver}}
      {{include 'trade/proposal_items.html'}}
    	
      {{proposal_items = proposal_items_from_sender}}
      {{include 'trade/proposal_items.html'}}
    	
      <div class="row">
        <div class="col-md-12" style="margin-top: 20px; padding: 0;">
          <label>Message:</label>
          <textarea id="message" name="message" class="form-control" rows="3" style="min-width: 100%; max-width: 100%;">{{=current_proposal.message}}</textarea>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12" style="margin-top: 20px;">
          <div class="btn-toolbar pull-right">
            <a href="{{=URL('trade', 'cancel_proposal', args=[current_proposal.id])}}" class="btn btn-default proposal-button">Cancel</a>
            <a href="{{=URL('trade', 'send_proposal', args=[current_proposal.id])}}" class="btn btn-success proposal-button">Send Trade Proposal</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{{block page_js}}
<script>
var current_proposal_id = {{=current_proposal.id}};
</script>
<script src="{{=URL('static', 'js/trades.js')}}"></script>
{{end page_js}}