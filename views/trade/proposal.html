<div class="container form-horizontal">
  {{include 'messages.html'}}
  <h2>Name</h2>
  <div class="form-group">
    <label for="title" class="col-md-2 control-label">Name</label>
    <div class="col-md-6">
      <input type="text" id="title" name="title" class="form-control" {{='placeholder' if current_proposal.title == DEFAULT_TRADE_TITLE else 'value'}}="{{=current_proposal.title}}"/>
    </div>
    <div class="col-md-4 form-helper">
      Specify the name of your trade. The name will help you identify this trade later. You can use dates or name of particular object.
    </div>
  </div>
  <hr/>
  <h2>Select Items</h2>
  <p class="form-helper">Use the tabs to swich between yours and thiers items. You can only view the tradable items. </p>
  <div class="form-group">
    <div class="col-md-12">
      <div class="tabs">
        <ul class="nav nav-tabs nav-justified" role="tablist">
          <li role="presentation" {{if selected_user.id != auth.user.id:}}class="active"{{pass}}>
            <a href="{{=URL(vars={'proposal': current_proposal.id, 'user': receiver.id})}}" class="proposal-button">Their Items</a>
          </li>
          <li role="presentation" {{if selected_user.id == auth.user.id:}}class="active"{{pass}}>
            <a href="{{=URL(vars={'proposal': current_proposal.id, 'user': auth.user.id})}}" class="proposal-button">Your Items</a>
          </li>
        </ul>

        <datalist id="objectsearch">
          {{for item in all_collection_items:}}
          <option value="{{=item.name}}"></option>
          {{pass}}
        </datalist>

        <div class="tab-content">
          {{if selected_user.id == auth.user.id:}}
          <div role="tabpanel" class="tab-pane active" id="your-items">
          {{else:}}
          <div role="tabpanel" class="tab-pane active" id="their-items">
          {{pass}}
          <div class="col-md-3">
            <h3>Collections</h3>
            <div class="list-group">
              {{for collection in selected_users_collections:}}
              {{active_collection = collection.id == selected_collection.id}}
              <a href="{{=URL(vars={'proposal': current_proposal.id, 'user': selected_collection.owner, 'collection': collection.id})}}" class="list-group-item {{if active_collection:}}active{{pass}} proposal-button">
                {{=collection.name}}
              </a>
              {{pass}}
            </div>
          </div>
          <div class="col-md-9 trading-window">
            {{if len(selected_items) > 0:}}
            {{for item in selected_items:}}
            {{item_selected = len([i for i in all_proposal_items if i.id == item.id]) > 0}}
            <div class="col-md-4 {{if item_selected:}}selected-panel{{pass}}">
              <div class="thumbnail thumbnail-small">
                {{if item_selected:}}
                {{item_action = URL(vars={'proposal': current_proposal.id, 'user': selected_user.id, 'remove': item.id, 'collection': selected_collection.id})}}
                {{else:}}
                {{item_action = URL(vars={'proposal': current_proposal.id, 'user': selected_user.id, 'add': item.id, 'collection': selected_collection.id})}}
                {{pass}}
                <img src="{{=URL('default', 'download', args=[item.image])}}" alt="{{=item.name}}" class=""/>
                <div class="panel-body">
                  <span class="label label-info pull-right"> &pound;{{=item.price}}</span>
                  <div class="object-name">{{=item.name}}</div>
                  <hr/>
                  {{if item_selected:}}
                  <a href="{{=item_action}}" class="btn btn-xs btn-danger">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Remove</a>
                  {{else:}}
                  <a href="{{=item_action}}" class="btn btn-xs btn-success">

                      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Trade</a>
                  {{pass}}
                  <a href="{{=URL('object', 'view', args=[item.id])}}" target="_blank" class="pull-right btn btn-xs btn-primary">Details</a>
                </div>
              </div>
            </div>
            {{pass}}
            {{else:}}
            <div class="alert alert-info">There are no objects in this collection.</div>
            {{pass}}
          </div>

          {{if selected_user.id == auth.user.id:}}
          <div role="tabpanel" class="tab-pane" id="their-items"></div>
          {{else:}}
          <div role="tabpanel" class="tab-pane" id="your-items"></div>
          {{pass}}
          </div>
        </div>
      </div>
    </div>
  </div>
  <hr/>
  <h2>Summary</h2>
  <p class="form-helper">Below you can view the summary of your trading proposal. You can specify quantities here.</p>
  <div class="form-group">
    {{proposal_items = proposal_items_from_receiver}}
    {{proposal_items_label = 'Their items:'}}
    {{include 'trade/proposal_items.html'}}

    {{proposal_items = proposal_items_from_sender}}
    {{proposal_items_label = 'Your items:'}}
    {{include 'trade/proposal_items.html'}}
  </div>
  <h2>Message</h2>
  <p class="form-helper">You can append a message to the person to clarify or ask something.</p>
  <div class="form-group">
    <div class="col-md-12">
      <label for="message">Message:</label>
      <textarea id="message" name="message" class="form-control" rows="3" style="min-width: 100%; max-width: 100%;">{{=current_proposal.message}}</textarea>
    </div>
  </div>

    <div class="form-group">
      <div class="col-md-12">
        <div class="btn-toolbar pull-right">
          {{send_text = 'Send Trade Proposal' if current_proposal.status == STATUS_PREPARE else 'Send Counter Proposal'}}
          <a href="{{=URL('trade', 'cancel_proposal', args=[current_proposal.id])}}" class="btn btn-default proposal-button">Cancel</a>
          <a href="{{=URL('trade', 'send_proposal', args=[current_proposal.id])}}" class="btn btn-success proposal-button send-proposal">{{=send_text}}</a>
        </div>
      </div>
    </div>
  </div>
</div>
